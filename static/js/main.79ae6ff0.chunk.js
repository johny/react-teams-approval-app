(this["webpackJsonpteam-approvals-app"]=this["webpackJsonpteam-approvals-app"]||[]).push([[0],{25:function(e,t,a){e.exports=a(59)},36:function(e,t,a){},37:function(e,t,a){},56:function(e,t,a){},57:function(e,t,a){},58:function(e,t,a){},59:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),l=a.n(c),u=a(3),o=(a(36),a(4)),s=(a(37),a(5)),i=a.n(s),p=a(7),m=a(24),d=a(6),v=a(12),f=a.n(v),E="https://s3-eu-west-1.amazonaws.com/spx-development",b=function(){var e=Object(p.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(E,"/contents/teams"),e.prev=1,e.next=4,f.a.get(t);case 4:return a=e.sent,n=a.data,e.abrupt("return",n);case 9:throw e.prev=9,e.t0=e.catch(1),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(E,"/contents/users"),e.prev=1,e.next=4,f.a.get(t);case 4:return a=e.sent,n=a.data,e.abrupt("return",n);case 9:throw e.prev=9,e.t0=e.catch(1),e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}(),y=Object(d.b)({name:"teams",initialState:{teamsById:{},usersById:{},isLoading:!1,error:null},reducers:{getDataStart:function(e){e.isLoading=!0,e.error=null},getDataSuccess:function(e,t){e.isLoading=!1,e.error=null;var a=t.payload,n=a.teams;a.users.forEach((function(t){return e.usersById[t.id]={id:t.id,firstName:t.first_name,lastName:t.last_name}})),n.forEach((function(t){return e.teamsById[t.id]=Object(m.a)({},t)}))},getDataError:function(e,t){e.isLoading=!1,e.error=t.payload}}}),_=y.reducer,j=y.actions,O=j.getDataStart,g=j.getDataSuccess,h=j.getDataError,I=(a(56),function(e){return"".concat(e.firstName," ").concat(e.lastName)}),N=function(e){var t=e.team,a=e.users,n=e.approvers,c=e.onTeamSelect,l=a.slice(0,3).map(I).join(", ");a.length>3&&(l="".concat(l,"..."));var u=n.slice(0,3).map(I).join(", ");return n.length>3&&(u="".concat(u,"...")),r.a.createElement("div",{className:"Team",onClick:function(){return c(t.id)},"data-testid":"Team-".concat(t.id)},r.a.createElement("strong",{className:"Team__name"},t.name),r.a.createElement("div",{className:"Team__users Team__users--all"},"Users: ",l),r.a.createElement("div",{className:"Team__users Team__users--approvers"},"Approvers: ",u))},B=function(e){var t=e.onTeamSelect,a=Object(u.b)(),c=Object(u.c)((function(e){return e.teams})),l=c.isLoading,s=c.error,m=c.teamsById,d=c.usersById,v=Object(u.c)((function(e){return e.approvalSteps})).approvalStepsById;Object(n.useEffect)((function(){0===Object.keys(m).length&&a(function(){var e=Object(p.a)(i.a.mark((function e(t){var a,n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t(O()),e.next=4,Promise.all([b(),S()]);case 4:a=e.sent,n=Object(o.a)(a,2),r=n[0],c=n[1],t(g({teams:r,users:c})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),t(h(e.t0.toString()));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}())}),[m,a]);return r.a.createElement("div",{className:"Page"},r.a.createElement("h2",null,"Teams"),l&&"Loading teams...",s&&"Error: ".concat(s),!l&&!s&&Object.keys(m).map((function(e){var a=m[e],n=a.users.map((function(e){return d[e]})),c=Object.values(v).filter((function(t){return t.teamId===e})).map((function(e){return d[e.userId]}));return r.a.createElement(N,{key:e,team:a,users:n,approvers:c,onTeamSelect:t})})))},w=a(23),A=Object(d.b)({name:"approvalSteps",initialState:{approvalStepsById:{}},reducers:{createApprovalStep:function(e,t){var a=t.payload;e.approvalStepsById[a.id]=a},deleteApprovalStep:function(e,t){delete e.approvalStepsById[t.payload]}}}),k=A.actions,T=k.createApprovalStep,F=k.deleteApprovalStep,C=A.reducer,x=function(e){var t=e.value;e.currency;return r.a.createElement("span",{className:"Money"},t,"\u20ac")},D=(a(57),function(e){var t=e.step,a=e.approvalUser,c=e.onRemove,l=Object(n.useState)(!1),u=Object(o.a)(l,2),s=u[0],i=u[1];return r.a.createElement("div",{className:"ApprovalStep"},r.a.createElement("div",{className:"ApprovalStep__bounds"},function(e){return 0===e.lowerBound&&e.upperBound?r.a.createElement(r.a.Fragment,null,"Up to ",r.a.createElement(x,{value:e.upperBound})):null===e.upperBound?r.a.createElement(r.a.Fragment,null,"Above ",r.a.createElement(x,{value:e.lowerBound})):r.a.createElement(r.a.Fragment,null,"From ",r.a.createElement(x,{value:e.lowerBound})," to"," ",r.a.createElement(x,{value:e.upperBound}))}(t),r.a.createElement("div",{className:"ApprovalStep__actions"},!s&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){return i(!0)}},"edit"),r.a.createElement("button",{onClick:c},"remove")))),r.a.createElement("div",{className:"ApprovalStep__user"},a))}),L=(a(58),function(e){var t=e.onCancel,a=e.onSubmit,c=e.users,l=Object(n.useRef)(null),u=Object(n.useRef)(null),o=Object(n.useRef)(null);return r.a.createElement("div",{className:"Form ApprovalStepForm"},r.a.createElement("div",{className:"Form__row"},r.a.createElement("label",null,"From ",r.a.createElement("input",{type:"number",defaultValue:0,ref:l})),r.a.createElement("label",null,"To ",r.a.createElement("input",{type:"number",ref:u}))),r.a.createElement("div",{className:"Form__row"},r.a.createElement("label",null,"Approval by ",r.a.createElement("select",{ref:o,placeholder:"Select user"},r.a.createElement("option",{value:""}),c.map((function(e){return r.a.createElement("option",{value:e.id,key:e.id},e.name)}))))),r.a.createElement("div",{className:"Form__actions"},r.a.createElement("button",{onClick:function(){var e,t,n,r=null===l||void 0===l||null===(e=l.current)||void 0===e?void 0:e.value,c=null===u||void 0===u||null===(t=u.current)||void 0===t?void 0:t.value,s=null===o||void 0===o||null===(n=o.current)||void 0===n?void 0:n.value;s&&r&&a(r,c,s)}},"Submit approval step")," or ",r.a.createElement("button",{onClick:function(){t()}},"Cancel")))}),R=function(e){var t=e.teamId,a=Object(u.c)((function(e){return e.teams.teamsById[t]})),c=Object(u.c)((function(e){return e.approvalSteps.approvalStepsById})),l=Object(u.c)((function(e){return e.teams.usersById})),s=Object(u.b)(),i=Object(n.useState)(!1),p=Object(o.a)(i,2),m=p[0],d=p[1];if(!a)return null;var v=Object.values(c).filter((function(e){return e.teamId===a.id})).sort((function(e,t){return e.lowerBound-t.lowerBound})),f=a.users.filter((function(e){return!v.some((function(t){return t.userId===e}))})).map((function(e){var t=l[e];return{id:t.id,name:I(t)}}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Set up approvers"),r.a.createElement("p",null,"Who can approve requests of team ",a.name,"?"),function(){var e=v.map((function(e){return r.a.createElement(D,{key:e.id,step:e,onRemove:function(){return t=e.id,void s(F(t));var t},approvalUser:I(l[e.userId])})}));return r.a.createElement(r.a.Fragment,null,e)}(),m?r.a.createElement(L,{users:f,onCancel:function(){d(!1)},onSubmit:function(e,t,n){var r={id:Object(w.a)(),lowerBound:parseInt(e,10),upperBound:t?parseInt(t,10):null,userId:n,teamId:a.id};s(T(r)),d(!1)}}):r.a.createElement("button",{onClick:function(){return d(!0)}},"Add approval step"))};var J=function(){var e=Object(n.useState)(null),t=Object(o.a)(e,2),a=t[0],c=t[1],l=function(){return c(null)};return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App__header"},r.a.createElement("h1",null,"Team approvals admin")),r.a.createElement("main",{className:"App__main"},r.a.createElement(B,{onTeamSelect:function(e){return c(e)}})),a&&r.a.createElement("div",{className:"App__overlay"},r.a.createElement("div",{className:"App__overlay-content"},r.a.createElement("button",{className:"App__overlay-cancel",onClick:l},"\xd7"),r.a.createElement(R,{teamId:a,onCancel:l}))))},U=a(2),M=Object(U.c)({teams:_,approvalSteps:C}),P=Object(d.a)({reducer:M,preloadedState:function(){try{var e=localStorage.getItem("state");if(null===e)return;return JSON.parse(e)}catch(t){return}}()});P.subscribe((function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(a){}}(P.getState())}));var q=P;!function(){var e=document.getElementById("root");l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u.a,{store:q},r.a.createElement(J,null))),e)}()}},[[25,1,2]]]);
//# sourceMappingURL=main.79ae6ff0.chunk.js.map